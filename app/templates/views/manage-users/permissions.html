{% from "components/checkbox.html" import checkbox, checkboxes_nested %}
{% from "components/radios.html" import radio, radios, conditional_radio_panel %}

<fieldset class="form-group">
  <legend class="form-label heading-small">
    Permissions
  </legend>
  <span class="hint">
    All team members can see sent messages.
  </span>
  {% for field in form.permissions_fields %}
    {{ checkbox(field) }}
  {% endfor %}
</fieldset>

{% if form.folder_permissions.all_template_folders %}
  {% set option_to_children_map = form.folder_permissions.children() %}
  {% set folder_permissions = get_tree_of_govuk_items_from_wtforms_option_fields(option_to_children_map[None], option_to_children_map) %}
  {{ notifyCollapsibleCheckboxes({
    "idPrefix": "folder_permissions",
    "fieldset": {
      "attributes": { "id": form.folder_permissions.id },
      "legend": {
        "text": "Folders this team member can see",
        "classes": "govuk-fieldset__legend--s"
      }
    },
    "asList": True,
    "items": folder_permissions
  }, 'folder') }}
{% elif user and user.platform_admin %}
  <p class="bottom-gutter">
    Platform admin users can access all template folders.
  </p>
{% endif %}

{% if service_has_email_auth %}
  {% if not mobile_number %}
    {{ radios(
      form.login_authentication,
      disable=['sms_auth'],
      option_hints={'sms_auth': 'Not available because this team member has not added a phone&nbsp;number to their profile'|safe}
    ) }}
  {% else %}
    {{ radios(form.login_authentication) }}
  {% endif %}
{% endif %}
