{% extends "withnav_template.html" %}

{% from "components/big-number.html" import big_number, big_number_with_status %}
{% from "components/show-more.html" import show_more %}
{% from "components/message-count-label.html" import message_count_label %}
{% from "components/table.html" import list_table, field, right_aligned_field_heading, hidden_field_heading %}

{% block page_title %}
  {{ current_service.name }} â€“ GOV.UK Notify
{% endblock %}

{% block maincolumn_content %}

  <div class="dashboard">

    <h1 class="visuallyhidden">Dashboard</h1>

    {% if current_user.has_permissions([
      'manage_templates', 'manage_api_keys', 'manage_users', 'manage_settings
    '], any_=True, admin_override=True) %}
      {% if current_service.restricted %}
        {% include 'views/dashboard/trial-mode-banner.html' %}
      {% endif %}
    {% elif not current_user.has_permissions(['send_texts', 'send_emails', 'send_letters'], any_=True) %}
      {% include 'views/dashboard/no-permissions-banner.html' %}
    {% endif %}

    <h2 class="heading-medium">
      In the last 7 days
    </h2>

    <div
      data-module="update-content"
      data-resource="{{url_for(".service_dashboard_updates", service_id=current_service.id)}}"
      data-key="today"
      data-interval-seconds="2"
      aria-live="polite"
    >
      <div class="grid-row">
        {% include 'views/dashboard/_totals.html' %}
        <div class="column-whole">
          {{ show_more(
            url_for('.weekly', service_id=current_service.id),
            'Compare to previous weeks'
          ) }}
        </div>
      </div>

      {% if template_statistics|length %}
        {% include 'views/dashboard/template-statistics.html' %}
        {{ show_more(
          url_for('.template_history', service_id=current_service.id),
          'See all templates used this year'
        ) }}
      {% endif %}

      {% if jobs %}
        {% include 'views/dashboard/_jobs.html' %}
        {{ show_more(
          url_for('.view_jobs', service_id=current_service.id),
          'See all uploaded files'
        ) }}
      {% endif %}

      {% if current_user.has_permissions(['manage_settings'], admin_override=True) %}
        <h2 class='heading-medium'>This year</h2>
        {% include 'views/dashboard/_jobs.html' %}
        {{ show_more(
          url_for(".usage", service_id=current_service['id']),
          'See usage breakdown'
        ) }}
      {% endif %}

    </div>


  </div>

{% endblock %}
