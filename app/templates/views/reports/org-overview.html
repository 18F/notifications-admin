{% from "components/big-number.html" import big_number %}
{% from "components/message-count-label.html" import message_count_label %}
{% from "components/table.html" import list_table, field, hidden_field_heading, row_heading, text_field, spark_bar_field, spark_bar %}
{% from "components/report-nav.html" import report_nav, org_report_nav %}
{% from "components/previous-next-navigation.html" import previous_next_navigation %}

{% extends "orgnav_template.html" %}

{% block service_page_title %}
  Reports
{% endblock %}

{% block maincolumn_content %}

    {% include 'views/reports/_heading.html' %}

    {{ org_report_nav(selected, current_service=current_service) }}

    <div class='grid-row bottom-gutter-1-2'>
      <div class='column-half'>
          <h2 style="margin-top: 10px;">2017 to 2018 financial year</h2>
          <div class="keyline-block">
            {{ big_number(4024.90, 'spent', currency='£', smaller=True) }}
          </div>
       </div>
      <div class='column-half'>
        <h2 class='' style="margin-top: 10px;">Emails</h2>
        <div class="keyline-block bottom-gutter-2-3">
          {{ big_number(3, '', smaller=True) }}
        </div>

        <h2 style="margin-top: 20px;">Text messages</h2>
        <div class="keyline-block bottom-gutter-2-3">
          {{ big_number(96102, '', smaller=True) }}
        </div>

        <h2 style="margin-top: 20px;">Letters</h2>
        <div class="keyline-block bottom-gutter-2-3">
          {{ big_number(119, '', smaller=True) }}
        </div>
      </div>
    </div>

    <nav class="browse-list dashboard-table">
      <ul>
        {% for service_index, service_name in services %}
          {% set sms = numbers[service_index + 5] * 33 %}
          {% set letters = (numbers[service_index + 5] / 25) | round | int %}
          {% set free_sms = (sms, 25000)|min %}
          {% set chargeable_sms = ((sms - 25000), 0)|max %}
          {% set chargeable_letters = letters %}
          <div class="keyline-block bottom-gutter-2-3">
            <div class="grid-row ">
              <div class="column-half">
                <li class="browse-list-item">
                  <a href="/organisations/test/redirect-to-service?fake_service_name={{ service_name }}" class="browse-list-link">{{ service_name }}</a>
                </li>
              </div>
              <div class="column-half">
                {{ big_number((chargeable_sms * 0.0155) + (chargeable_letters * 0.33), label, currency='£', smallest=True) }}
              </div>
            </div>
            <div class="grid-row">
              <div class="column-half">
                {{ spark_bar(sms + letters, 31818, failure_rate=failures[service_index + 5]) }}
              </div>
              <div class="column-half">
                <ul class="tabular-numbers" style="list-style: none;">

                  <li>{{ "{:,}".format(free_sms) }} free text messages</li>
                  {% if chargeable_sms > 0 %}
                    <li>{{ "{:,}".format(chargeable_sms) }} text messages at 1.55p</li>
                  {% endif %}
                  <li>{{ "{:,}".format(letters) }} letters at 33p</li>
                </ul>
              </div>
            </div>
          </div>
        {% endfor %}
        <div class="keyline-block">
          &nbsp;
        </div>
      </ul>
    </nav>

    <div>
      {{ previous_next_navigation({
        'url': '#',
        'title': '2016 to 2017',
        'label': 'financial year'
      }, {
        'url': '#',
        'title': '2018 to 2019',
        'label': 'financial year'
      }) }}
    </div>

{% endblock %}
